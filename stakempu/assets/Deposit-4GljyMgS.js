import{K as a,L as e,W as t,M as s,N as i,E as n,O as l}from"./MsStake-iw_DxEVZ.js";import{E as u}from"./el-input-PVN7fMVO.js";import{g as o,_ as d}from"./index-JdbrOlwk.js";import{u as c,C as r,b as v}from"./custompopups-Esm_BiU5.js";/* empty css               */import{E as p}from"./ERC20-52pCtVWV.js";import{d as m,L as f,r as w,x as g,o as x,c as S,f as E,E as y,u as b,M as h,t as C,b as O,n as _,e as k,F as D,a as F,g as N,p as A,h as B,_ as j}from"./index-lRGnzVmH.js";const M=a=>(A("data-v-3e26b7a1"),a=a(),B(),a),J={class:"deposit"},V={class:"deposit-con_2"},I={class:"wrap__text"},T=M((()=>E("text",{style:{"font-family":"'sans-serif'"}},"MPU",-1))),L=M((()=>E("div",{class:"your__balance"},"Your balance",-1))),U=M((()=>E("div",{class:"name"},[E("text",{class:"new__name"},"Stake")],-1))),P={class:"parameter amont"},R=M((()=>E("div",{class:"name"},[E("text",{class:"new__name"},"To")],-1))),W=M((()=>E("div",{style:{display:"flex","align-items":"center"}},[E("img",{class:"logo",src:d,style:{width:"230px"}})],-1))),Y={class:"hint-content"},z={key:0,class:"title"},K=["src"],$=["src"],q={key:1,class:"hint-name"},G={key:2,class:"hint-name success"},H=j(m({__name:"Deposit",setup(d){const m=f(),A=c(),B=w(!1),j=w(),M=w(!1),H=w(1),Q=w("0xF09FD56e72933f4dC6817006660E6f0d13eB4E75"),X=w(!1);g((async()=>{await aa(),await ea(),X.value=window.innerWidth<=750,window.addEventListener("resize",ta)}));const Z=void 0===window.ethereum?o("https://rpc.ankr.com/eth","0xaa36a7"):new t(window.ethereum),aa=async()=>{const t=new a("0x7265b91dAEE8aeFdCAc7DCd263D2624065352308",p.abi,Z),s=await t.balanceOf(m.accounts);let i=e(s.toString());return m.SetBalance(i),i},ea=async()=>{const t=new a("0x7265b91dAEE8aeFdCAc7DCd263D2624065352308",p.abi,Z),s=await t.allowance(m.accounts,"0xF09FD56e72933f4dC6817006660E6f0d13eB4E75");let i=e(s.toString());return m.SetAllowance(i),i},ta=()=>{X.value=window.innerWidth<=750},sa=async()=>{if(na.value||B.value||!j.value)return;B.value=!0,A.Setpopupsdata(!0,1);const e=new t(window.ethereum).getSigner(),n=new a(Q.value,s.abi,e);try{const e=j.value,s=i(e.toString());if(0==m.Balance)return A.Setpopupsdata(!0,6,"Your balance is insufficient"),void(B.value=!1);if(s.gt(i(m.Balance.toString())))return A.Setpopupsdata(!0,6,"Your balance is insufficient"),void(B.value=!1);await ea();if(s.gt(i(m.Allowance.toString())))try{A.Setpopupsdata(!0,5),await(async()=>{const e=new t(window.ethereum).getSigner(),s=new a("0x7265b91dAEE8aeFdCAc7DCd263D2624065352308",p.abi,e),i=await s.approve("0xF09FD56e72933f4dC6817006660E6f0d13eB4E75",l);return await i.wait()})(),A.Setpopupsdata(!0,1)}catch(u){return B.value=!1,void((JSON.parse(JSON.stringify(u)).code="ACTION_REJECTED")?A.Setpopupsdata(!0,3):A.Setpopupsdata(!0,4))}const o=await n.Stake(i(e.toString()));await o.wait();A.Setpopupsdata(!0,2),ia(),j.value="",B.value=!1}catch(o){(JSON.parse(JSON.stringify(o)).code="ACTION_REJECTED")?A.Setpopupsdata(!0,3):A.Setpopupsdata(!0,4),B.value=!1}},ia=async()=>{j.value="",await(async()=>{const e=new a("0xF09FD56e72933f4dC6817006660E6f0d13eB4E75",s.abi,Z);let t=0;const i=await e.rInfo(),n=i.totalStakeBalance;if(0===n)return t;const l=i.rewardPerDay;t=Number((l/n*365*100).toFixed(2)),isNaN(t)&&(t=0),m.SetApr(t)})(),await aa(),await ea()},na=w(!1),la=()=>{na.value=j.value<100||!/^\d*(\.\d+)?$/.test(j.value)},ua=w({img:r,text:"Confirm this transaction in your wallet"});return x((()=>{window.removeEventListener("resize",ta)})),(a,e)=>{const t=u,s=n;return F(),S(D,null,[E("div",J,[E("div",V,[E("div",{class:"list",style:y(b(m).isMobile?"margin-top:100px":"")},[E("div",I,[h(C(Number(b(m).Balance))+" ",1),T]),L,U,E("div",P,[O(t,{type:"number",class:_([{"limit-hov":na.value},"amont-inp"]),oninput:"\r\n                if(value < 0){value = 0}\r\n                // if(value.indexOf('.') == -1 && value.length > 6) {value=value.slice(0,6)} if(value.indexOf('0') == 0) {value=value.slice(1)}\r\n                if(value.indexOf('.') >= 6) {value= Number(value.slice(0,value.indexOf('.'))) +value.slice(value.indexOf('.'),value.indexOf('.')+7)}\r\n                if(value.indexOf('.') > -1 && value.indexOf('.') <= 6) { value=Number(value.slice(0,value.indexOf('.'))) + value.slice(value.indexOf('.'),value.indexOf('.')+7)} \r\n                ",placeholder:"Enter stake amount",modelValue:j.value,"onUpdate:modelValue":e[0]||(e[0]=a=>j.value=a),onInput:la,name:"",id:""},null,8,["class","modelValue"]),E("div",{class:_(["min-amont",{"limit-color":na.value}])}," Minimum stake 100 MPU ",2)]),R,W],4),E("div",{class:"send mousein",onClick:sa,style:y(X.value?"margin-top: -40px":"")}," Stake ",4)])]),O(s,{modelValue:M.value,"onUpdate:modelValue":e[1]||(e[1]=a=>M.value=a),width:"30%",onClose:ia,"show-close":1!=H.value&&5!=H.value,"align-center":"",class:"signdialog"},{default:k((()=>[E("div",Y,[H.value<=2||5==H.value?(F(),S("div",z," Sign transaction ")):N("",!0),E("div",{class:_(["hint-icon",{noimg:H.value>2&&5!=H.value}])},[1==H.value||5==H.value?(F(),S("img",{key:0,class:"hint-paddimg-icon",src:b(v),alt:""},null,8,K)):N("",!0),ua.value.img?(F(),S("img",{key:1,class:_(["img",{paddimg:1==H.value||5==H.value}]),src:ua.value.img,alt:""},null,10,$)):N("",!0)],2),2!=H.value?(F(),S("div",q,C(ua.value.text),1)):(F(),S("div",G,C(ua.value.text),1))])])),_:1},8,["modelValue","show-close"])],64)}}}),[["__scopeId","data-v-3e26b7a1"]]);export{H as default};
