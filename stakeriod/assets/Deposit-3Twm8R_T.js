import{R as a,S as e,W as t,U as s,V as i,E as n,X as l}from"./MsStake-XXQrYsOj.js";import{E as o}from"./el-input-YakXQcco.js";import{u,C as r,b as d}from"./custompopups-GfQchbWB.js";/* empty css               */import{E as c}from"./ERC20-wN4H9J0h.js";import{d as v,L as p,r as m,x as w,o as f,c as g,f as x,b as S,E,u as b,t as y,n as h,e as C,F as O,a as k,g as D,p as F,h as N,_ as A}from"./index-HmN8oWZL.js";import{P as B}from"./planet-IJmQEfjB.js";import{g as _}from"./index-WsM8dx5w.js";const j=""+new URL("mini-logo-HTqfHgs0.png",import.meta.url).href,T=a=>(F("data-v-b6167372"),a=a(),N(),a),I={class:"deposit"},R={class:"list"},V={class:"item-row"},J=T((()=>x("div",{class:"name"},"Your balance",-1))),M={class:"parameter wrap-text"},L={class:"item-row"},U=T((()=>x("div",{class:"name"},"stake",-1))),z={class:"parameter amont"},W={class:"item-row"},Y=T((()=>x("div",{class:"name"},"To",-1))),H={style:{display:"flex","align-items":"center"}},P=T((()=>x("text",{style:{color:"#fff","font-size":"48px","text-indent":"5px"}},null,-1))),q={class:"item-row deposit-btn"},X={class:"hint-content"},$={key:0,class:"title"},G=["src"],K=["src"],Q={key:1,class:"hint-name"},Z={key:2,class:"hint-name success"},aa=A(v({__name:"Deposit",setup(v){const F=p(),N=u(),A=m(!1),T=m(),aa=m(!1),ea=m(1),ta=m("0xF09FD56e72933f4dC6817006660E6f0d13eB4E75"),sa=m(!1);w((async()=>{await na(),await la(),sa.value=window.innerWidth<=750,window.addEventListener("resize",oa)}));const ia=void 0===window.ethereum?_("https://rpc.ankr.com/eth","0xaa36a7"):new t(window.ethereum),na=async()=>{const t=new a("0x7265b91dAEE8aeFdCAc7DCd263D2624065352308",c.abi,ia),s=await t.balanceOf(F.accounts);let i=e(s.toString());return F.SetBalance(i),i},la=async()=>{const t=new a("0x7265b91dAEE8aeFdCAc7DCd263D2624065352308",c.abi,ia),s=await t.allowance(F.accounts,"0xF09FD56e72933f4dC6817006660E6f0d13eB4E75");let i=e(s.toString());return F.SetAllowance(i),i},oa=()=>{sa.value=window.innerWidth<=750},ua=async()=>{if(da.value||A.value||!T.value)return;A.value=!0,N.Setpopupsdata(!0,1);const e=new t(window.ethereum).getSigner(),n=new a(ta.value,s.abi,e);try{const e=T.value,s=i(e.toString());if(0==F.Balance)return N.Setpopupsdata(!0,6,"Your balance is insufficient"),void(A.value=!1);if(s.gt(i(F.Balance.toString())))return N.Setpopupsdata(!0,6,"Your balance is insufficient"),void(A.value=!1);await la();if(s.gt(i(F.Allowance.toString())))try{N.Setpopupsdata(!0,5),await(async()=>{const e=new t(window.ethereum).getSigner(),s=new a("0x7265b91dAEE8aeFdCAc7DCd263D2624065352308",c.abi,e),i=await s.approve("0xF09FD56e72933f4dC6817006660E6f0d13eB4E75",l);return await i.wait()})(),N.Setpopupsdata(!0,1)}catch(o){return A.value=!1,void((JSON.parse(JSON.stringify(o)).code="ACTION_REJECTED")?N.Setpopupsdata(!0,3):N.Setpopupsdata(!0,4))}const u=await n.Stake(i(e.toString()));await u.wait();N.Setpopupsdata(!0,2),ra(),T.value="",A.value=!1}catch(u){(JSON.parse(JSON.stringify(u)).code="ACTION_REJECTED")?N.Setpopupsdata(!0,3):N.Setpopupsdata(!0,4),A.value=!1}},ra=async()=>{T.value="",await(async()=>{const e=new a("0xF09FD56e72933f4dC6817006660E6f0d13eB4E75",s.abi,ia);let t=0;const i=await e.rInfo(),n=i.totalStakeBalance;if(0===n)return t;const l=i.rewardPerDay;t=Number((l/n*365*100).toFixed(2)),isNaN(t)&&(t=0),F.SetApr(t)})(),await na(),await la()},da=m(!1),ca=()=>{da.value=T.value<100||!/^\d*(\.\d+)?$/.test(T.value)},va=m({img:r,text:"Confirm this transaction in your wallet"});return f((()=>{window.removeEventListener("resize",oa)})),(a,e)=>{const t=o,s=n;return k(),g(O,null,[x("div",I,[S(B),x("div",{class:"deposit-con_2",style:E(b(F).isMobile?"margin-top:150px":"")},[x("div",R,[x("div",V,[J,x("div",M,y(Number(b(F).Balance))+" STRIO",1)]),x("div",L,[U,x("div",z,[S(t,{type:"number",class:h([{"limit-hov":da.value},"amont-inp"]),oninput:"\r\n                if(value < 0){value = 0}\r\n                if(value.indexOf('.') >= 6) {value= Number(value.slice(0,value.indexOf('.'))) +value.slice(value.indexOf('.'),value.indexOf('.')+7)}\r\n                if(value.indexOf('.') > -1 && value.indexOf('.') <= 6) { value=Number(value.slice(0,value.indexOf('.'))) + value.slice(value.indexOf('.'),value.indexOf('.')+7)} \r\n                ",placeholder:"Enter stake amount",modelValue:T.value,"onUpdate:modelValue":e[0]||(e[0]=a=>T.value=a),onInput:ca,name:"",id:""},null,8,["class","modelValue"]),x("div",{class:h(["min-amont",{"limit-color":da.value}])},"Minimum stake 100 STRIO",2)])]),x("div",W,[Y,x("div",H,[x("img",{class:"logo",src:j,style:E(b(F).isMobile?"margin-left: 10px":""),alt:""},null,4),P])])]),x("div",q,[x("div",{class:"send mousein",onClick:ua,style:E(b(F).isMobile?"margin-top: -40px":"")},"Stake",4)])],4)]),S(s,{modelValue:aa.value,"onUpdate:modelValue":e[1]||(e[1]=a=>aa.value=a),width:"30%",onClose:ra,"show-close":1!=ea.value&&5!=ea.value,"align-center":"",class:"signdialog"},{default:C((()=>[x("div",X,[ea.value<=2||5==ea.value?(k(),g("div",$,"Sign transaction")):D("",!0),x("div",{class:h(["hint-icon",{noimg:ea.value>2&&5!=ea.value}])},[1==ea.value||5==ea.value?(k(),g("img",{key:0,class:"hint-paddimg-icon",src:b(d),alt:""},null,8,G)):D("",!0),va.value.img?(k(),g("img",{key:1,class:h(["img",{paddimg:1==ea.value||5==ea.value}]),src:va.value.img,alt:""},null,10,K)):D("",!0)],2),2!=ea.value?(k(),g("div",Q,y(va.value.text),1)):(k(),g("div",Z,y(va.value.text),1))])])),_:1},8,["modelValue","show-close"])],64)}}}),[["__scopeId","data-v-b6167372"]]);export{aa as default};
